<ng-template #tableHeaderRowTemplate let-sticky="sticky">
    <tr>
        <th class="select sticky-column" *ngIf="batchActions.length > 0 || selectable">
            <input *ngIf="!singleSelect" type="checkbox" cui-checkbox
                   [ngClass]="{'indeterminate': countSelectedItems(false) > 0 && !isAllItemSelected()}"
                   [checked]="isAllItemSelected()" [attr.id]="'toggleAll_' + uuid" (change)="toggleAllItems()"/>
            <label *ngIf="!singleSelect" [attr.for]="'toggleAll_' + uuid"></label>
        </th>
        <th *ngFor="let item of headers"
            [ngStyle]="getStyles(item)"
            [ngClass]="item.align"
            [class.not-orderable]="isNotOrderableCell(item)"
            [class.hidden-column]="isCellHidden(item)">
            <span (click)="headerClick(item, $event)" [cuiTooltip]="item.tooltip" cui-table-sorting data-e2e-click="">

                <cui-icon *ngIf="item.align == 'align-right' && getOrderIcon(item) != ''"
                          [icon]="getOrderIcon(item)" class="sorting"></cui-icon>
                <cui-icon *ngIf="item.icon" class="icon no-click" [icon]="item.icon"> </cui-icon>
                    <ng-container *ngIf="!headerTemplate"><span cui-table-sorting>{{item.label}}</span></ng-container>
                    <ng-container *ngIf="headerTemplate">
                        <ng-template
                             [ngTemplateOutlet]="headerTemplate"
                             [ngTemplateOutletContext]="{header: item}">
                        </ng-template>
                    </ng-container>
                <cui-icon *ngIf="item.sticky" icon="lock"></cui-icon>
                <span class="required" *ngIf="editableTable && item.editRequired"> *</span>
                <cui-icon class="sorting" *ngIf="item.align !== 'align-right' && getOrderIcon(item) != ''"
                          [icon]="getOrderIcon(item)"></cui-icon>
            </span>
        </th>
        <th class="single-action sticky-column"
            [class.selected-columns-toggled]="selectedColumns.length !== headers.length">
            <ng-container *ngIf="!editableTable">
                <span class="hidden-columns-indicator"
                      *ngIf="headers.length !== selectedColumns.length"
                      [innerHTML]="headers.length - selectedColumns.length"></span>
                <cui-icon [icon]="'more'" class="select-columns-icon" (click)="toggleSelectColumns($event)"
                          (keyup.enter)="toggleSelectColumns($event)" data-e2e-click=""></cui-icon>
                <span #stickySelectedColumnsRef *ngIf="sticky"></span>
                <span #selectedColumnsRef *ngIf="!sticky"></span>
                <cui-select [multiple]="true"
                            width="200"
                            [ngModel]="selectedColumns"
                            [placeholder]="'Select columns'"
                            (onChange)="toggleColumns($event)"
                            #selectedColumnsDropRef
                            class="selected-columns"
                            *ngIf="!sticky">
                    <ng-container *ngFor="let column of headers">
                        <cui-option [ngValue]="column" *ngIf="!column.editType" (onSelectItem)="itemClicked(column)">
                            {{column.label}} <cui-icon *ngIf="!column.hidden" [icon]="column._sticky ? 'lock' : 'unlocked'" (click)="toggleStickyColumn(column)" data-e2e-click=""></cui-icon>
                        </cui-option>
                    </ng-container>
                </cui-select>
            </ng-container>
        </th>
        <th *ngIf="editableTable" class="pseudo-header"></th>
    </tr>
</ng-template>
<ng-template #batchActionsTemplate>
    <cui-batch-actions
        [paddingLeft]="paddingLeft"
        [isAbsolute]="tableActions?.length > 0"
        [visible]="(batchActions.length > 0 && isAnyItemsSelected()) || (selectable && isAnyItemsSelected())"
        [selectedItems]="getSelectedItems()"
        [batchActions]="batchActions"
        [selectedItemsText]="'ODEN.COMPONENTS.TABLE.ITEMS_SELECTED' | translate:{COUNT: countSelectedItems()}"
        (onBatchClick)="batchClick($event)"
        (onDeselectAll)="deselectAllItems()"
        *ngIf="useBatchActions && (batchActions.length > 0 || selectable)"
    ></cui-batch-actions>
</ng-template>
<div class="table-actions" *ngIf="tableActions?.length > 0 || tableTitle?.length > 0 || showEditAllSwitch || titleTemplate">
    <h4 *ngIf="tableTitle?.length || titleTemplate">
        <ng-container *ngIf="titleTemplate">
            <ng-template [ngTemplateOutlet]="titleTemplate"></ng-template>
        </ng-container>
        {{tableTitle}}
        <span *ngIf="tableTitleCount?.toString().length > 0">
            ({{tableTitleCount}})
        </span>
    </h4>
    <div class="action-items-wrapper">
        <div class="action-items" *ngIf="tableActions?.length > 0 || showEditAllSwitch">
            <button cui-button class="small" *ngFor="let tableAction of tableActions" value="{{tableAction.label}}"
                    (click)="onTableAction(tableAction)" [disabled]="tableAction.disabled" data-e2e-click=""></button>
            <div class="edit-all switcher-group" *ngIf="showEditAllSwitch">
                <span class="field-header left">{{'ODEN.COMPONENTS.TABLE.EDIT_ALL_ROWS' | translate}}</span>
                <cui-switcher (change)="editAllChange($event.target.checked)">
                </cui-switcher>
            </div>
        </div>
        <cui-action-menu [actions]="titleActions" (onActionClick)="titleActionClick($event, data)">
        </cui-action-menu>
    </div>
</div>
<div #stickyHeaderElementRef class="sticky" [class.hidden]="!showSticky" *ngIf="stickyHeaders">
    <span #stickyBatchActionsContainer></span>
    <div class="cui-table-wrapper" [style.paddingLeft]="paddingLeft" [class.hidden]="!showStickyTableHeader">
        <div class="wrapper">
            <table>
                <thead>
                    <ng-template [ngTemplateOutlet]="tableHeaderRowTemplate" [ngTemplateOutletContext]="{sticky: true}"></ng-template>
                </thead>
            </table>
        </div>
    </div>
</div>
<div #batchActionsContainer></div>
<div #batchActionsElementRef>
    <ng-template [ngTemplateOutlet]="batchActionsTemplate"></ng-template>
</div>
<cui-container class="filter-actions"
               *ngIf="_filterQueryList.first || filterTemplate || showFilter || showCategoryFilter || columnsSets.length > 1 || dateFilters.length > 0 || periodDateFilters.length > 0">
    <div class="list-controls-column-set-container">
        <div class="list-controls-container">
            <ng-content select="cui-list-controller"></ng-content>
            <ng-container *ngIf="filterTemplate">
                <cui-list-controller>
                    <ng-template [ngTemplateOutlet]="filterTemplate"></ng-template>
                </cui-list-controller>
            </ng-container>
            <ng-container *ngIf="!filterTemplate">
                <cui-list-controller
                    *ngIf="showFilter || showCategoryFilter || dateFilters.length > 0 || periodDateFilters.length > 0">
                    <cui-list-controller-filter
                        (onFilterChange)="onFilterTable($event)"
                        [value]="filterValue"
                        [placeholder]="'Filter'"
                        *ngIf="showFilter"></cui-list-controller-filter>
                    <cui-list-controller-category-filter
                        *ngFor="let categoryFilterGroup of categoryFilterGroups"
                        (onCategoryFilterChange)="onCategoryFilterTable($event)"
                        [filterGroup]="categoryFilterGroup"></cui-list-controller-category-filter>
                    <cui-list-controller-general
                        *ngFor="let dateFilterGroup of dateFilters"
                        [label]="dateFilterGroup.label">
                        <cui-date-input
                            *ngIf="dateFilterGroup.type === dateType.DATE"
                            [(ngModel)]="dateFilterGroup.value"
                            (onChange)="onDateFilterTable(dateFilterGroup, $event)"></cui-date-input>
                        <cui-date-time-input
                            *ngIf="dateFilterGroup.type === dateType.DATETIME"
                            [(ngModel)]="dateFilterGroup.value"
                            (onChange)="onDateFilterTable(dateFilterGroup, $event)"></cui-date-time-input>
                        <cui-time-input
                            *ngIf="dateFilterGroup.type === dateType.TIME"
                            [(ngModel)]="dateFilterGroup.value"
                            (onChange)="onDateFilterTable(dateFilterGroup, $event)"></cui-time-input>
                    </cui-list-controller-general>
                    <cui-list-controller-general *ngIf="periodDateFilters.length > 0" [label]="periodDateFilterLabel">
                        <cui-period-picker
                            [label]="periodDateFilterDelimiterLabel ? periodDateFilterDelimiterLabel : null">
                            <ng-container *ngFor="let periodDateFilterGroup of periodDateFilters">
                                <cui-date-input
                                    *ngIf="periodDateFilterGroup.type === dateType.DATE"
                                    [(ngModel)]="periodDateFilterGroup.value"
                                    (onChange)="onPeriodDateFilterTable()"></cui-date-input>
                                <cui-date-time-input
                                    *ngIf="periodDateFilterGroup.type === dateType.DATETIME"
                                    [(ngModel)]="periodDateFilterGroup.value"
                                    (onChange)="onPeriodDateFilterTable()"></cui-date-time-input>
                                <cui-time-input
                                    *ngIf="periodDateFilterGroup.type === dateType.TIME"
                                    [(ngModel)]="periodDateFilterGroup.value"
                                    (onChange)="onPeriodDateFilterTable()"></cui-time-input>
                            </ng-container>
                        </cui-period-picker>
                    </cui-list-controller-general>
                </cui-list-controller>
            </ng-container>
        </div>
        <div class="column-set-container" *ngIf="columnsSets.length > 1">
            <div class="column-set">
                <cui-icon
                    class="small"
                    [cuiTooltip]="currentColumnSetIndex < columnsSets.length - 1 ? getColumnSetLabels(columnsSets[currentColumnSetIndex + 1]) : ''"
                    icon="chevron-right"
                    [class.column-set-pointer-active]="currentColumnSetIndex < columnsSets.length - 1"
                    (click)="nextColumnSet()" data-e2e-click=""></cui-icon>
                <div class="column-pointers">
                    <div
                        *ngFor="let columnSet of columnsSets; let i = index"
                        [cuiTooltip]="getColumnSetLabels(columnSet)"
                        [class.current-column-set]="currentColumnSetIndex === i" (click)="changeColumnSet(i)" data-e2e-click=""></div>
                </div>
                <cui-icon
                    class="small"
                    [cuiTooltip]="currentColumnSetIndex > 0 ? getColumnSetLabels(columnsSets[currentColumnSetIndex - 1]) : ''"
                    icon="chevron-left" [class.column-set-pointer-active]="currentColumnSetIndex > 0"
                    (click)="prevColumnSet()" data-e2e-click=""></cui-icon>
                <span>{{'ODEN.COMPONENTS.TABLE.COLUMN_SET' | translate}}</span>
            </div>
        </div>
    </div>
</cui-container>
<div class="cui-table-wrapper" #tableElementRef>
    <table>
        <thead #tableHeaderElementRef>
        <ng-template [ngTemplateOutlet]="tableHeaderRowTemplate"></ng-template>
        </thead>
        <tbody>
        <ng-container *ngFor="let row of viewData(); let rowIndex = index">
            <tr cui-table-row
                #rowComponent
                [rowTemplate]="rowTemplate"
                [rowIndex]="rowIndex"
                [class]="row.selected ? 'selected' : ''"
                [clickable]="onRowClick.observers.length > 0"
                [ngClass]="[getDrilldownClass(row), getRowCssClass(row), row.multiRow && multiRowTemplate ? 'hasMultirow': '']"
                [data]="row"
                [hasBatchActions]="batchActions.length > 0"
                [singleActions]="singleActions"
                [hideSingleActions]="isAnyItemsSelected()"
                [headers]="headers"
                [edit]="row.edit"
                [focus]="row.focus"
                [selectable]="selectable"
                (onRowClick)="rowClick($event, rowComponent)"
                (onActionMenuDisplay)="onActionMenuClick($event)"
                (onSingleClick)="singleClick($event)"
                (onBatchChanged)="onRowChange($event)"
                (onFieldEvent)="fieldEvent($event)"
                (onNextRow)="nextRow($event)"
                [editableTable]="editableTable"
                [singleSelect]="singleSelect">
            </tr>
            <tr *ngIf="row.multiRow && multiRowTemplate" class="multi-row"
                (mouseover)="toggleHoverState(row, true)"
                (mouseleave)="toggleHoverState(row, false)"
                (click)="onRowClick.observers.length > 0 || row.path ? rowClick(row) : null"
                [ngClass]="[getRowCssClass(row), row.selected ? 'selected' : '', row.multiRowWrap ? 'wordwrap' : '']"
                data-e2e-click="">
                <td *ngIf="batchActions.length > 0 || selectable"></td>
                <ng-template [ngTemplateOutlet]="multiRowTemplate" [ngTemplateOutletContext]="{ row: row, colspan: getColspan(row), index: rowIndex }"></ng-template>
                <td *ngIf="(singleActions || row?.rowActions) && row.singleActions !== false"></td>

            </tr>
        </ng-container>

        <tr cui-table-row-placeholder *ngIf="displayPlaceholder()"
            [placeholderRowTemplate]="placeholderRowTemplate"
            [headers]="headers"
            [hasBatchActions]="batchActions?.length > 0"
            (onNextRow)="nextRow($event)"
            [hasSingleActions]="singleActions?.length > 0"
            [@placeholderRowVisibility]="placeholderRowAnimation">
        </tr>
        </tbody>
        <tfoot>
        <tr *ngIf="footerRowTemplate">
            <ng-template [ngTemplateOutlet]="footerRowTemplate"></ng-template>
        </tr>
        </tfoot>
    </table>
</div>
<cui-pagination *ngIf="pagination" [paginationData]="_paginationData" (onPagination)="paginationClick()"></cui-pagination>

[//]: # (title: Guided workflow)
[//]: # (category: Guided workflow)
[//]: # (icon: fa-map-signs)

#Guided workflow
* import { GuidedWorkflowModule } from '@ericsson/oden';

Guided tasks helps the user achieve complex task by dividing them in to smaller user steps. By using the `GuidedWorkflowService` you have 
full control over the different guides and tasks you create.

A guide is represented by a `WorkflowGuide` that contains `WorkflowGuideStep`s.

##GuidedWordflowService
Import GuidedWorkflowModule.forRoot() to instantiate GuidedWorkflowService

####workflow-guide.model.ts
```
export class WorkflowGuide {
    id: string;
    steps: Array<WorkflowGuideStep>;
    overviewSteps?: Array<WorkflowGuideStep>;
    activeStep?: number = 1;
    visible?: boolean = false;
    minimized?: boolean = false;
    maximized?: boolean = false;
    breadcrumb?: Array<BreadcrumbItem>;
    actionMenuActions?: Array<ActionItem>;
    actionMenuEvent?: any;
    finishTitle: string = 'Finish';
    finishLocked: boolean = true;
    hideBack: boolean = false;
    finishEvent?: any;
    pauseEvent?: any;
    goToEvent?: any;
    maximizeEvent?: any;
    position?: string = GUIDED_WORKFLOW.BOTTOM;
    data?: any;
}
```

####workflow-guide-step.model.ts
```
export class WorkflowGuideStep {
    number: number;
    title: string;
    description: string;
    path: string; // browser will go to this path when the step is accessed
    locked: boolean = false; // a locked step cannot be accessed
    lockedMessage: string = ''; // this message will show up in tooltip over the locked button
    dirty?: boolean = false; // useful attribute to store if things have changed in the step
    hideFutureSteps?: boolean = false; // set this to true to temporarily hide title and description for upcoming steps
    nextDisabled?: boolean = false; // set this to true to disable the Next button. Only applicable if hideFutureSteps is true.
    nextDisabledMessage: string = ''; // this message will show up in tooltip over the disabled Next button (for hideFutureSteps only)
    data?: any; // save custom data here
}
```

##Methods

###createGuide(_WorkflowGuide_)

This is how you create a guide:

```
this.guidedWorkflowService.createGuide({
    id: 'my-unique-guide-name',
    steps: [
        new WorkflowGuideStep({
            title: 'Details',
            number: 1,
            path: '/bill-specifications/create/details',
            description: 'Add specification details and from when it should be valid.'
        }),
        new WorkflowGuideStep({
            title: 'Relations',
            number: 2,
            path: '/bill-specifications/create/schedule',
            description: 'Add schedule definitions from library.',
            lockedMessage: 'You have to finish step 1 first',
            locked: true,
            hideFutureSteps: true,
            nextDisabled: true,
            nextDisabledMessage: 'Please fill in a title first'
        })
    ],
    hideBack: true, // this hides the back button so the user can't go back in the guide
    actionMenuActions: [new ActionItem({
        label: 'Test',
        action: 'test'
    })],
    actionMenuEvent: (action: any) => {
        if (action.action === 'test') {
            //
        }
    },
    breadcrumb: [new BreadcrumbItem({id: 0, title: 'Create bill specification'})],
    finishEvent: () => {
        this.guidedWorkflowService.hide('my-unique-guide-name');
        this._applicationService.navigateToPath('/bill-specifications/start');
        let _action = new ActionItem({
            label: 'Close',
            action: 'close'
        });
        let snackBar = this.guidedWorkflowService.createSnackbar('Bill created', _action);
        snackBar.onAction.subscribe(() => snackBar.close() );
    },
    pauseEvent: () => {
        this.guidedWorkflowService.hideAll();
        this._applicationService.navigateToPath('/bill-specifications/start');
    },
    goToEvent: (stepNumber: number) => {
        // this function will be called whenever a user presses a back or next button
        if (stepNumber === 3 && this.guidedWorkflowService.getGuideById('my-unique-guide-name').steps.length < 3) {
            this.guidedWorkflowService.getGuideById('my-unique-guide-name').steps[1].hideFutureSteps = false;
            this.guidedWorkflowService.getGuideById('my-unique-guide-name').steps.push(
                new WorkflowGuideStep({
                    title: 'My third step',
                    number: 3,
                    path: '/url/to/my/step',
                    description: 'Description of my new step.'
                })
            );
            this.guidedWorkflowService.changeStep(this.guidedWorkflowService.getGuideById('my-unique-guide-name'), 3);
        }
    },
    maximizeEvent: () => {
        // this will be called when the user maximizes the guide. needs to be a Promise.
        // without a maximizeEvent, the overview will get populated automatically from the guide's steps.
        return new Promise((resolve) => {
            myCustomApiCall.then(() => {
                this.guidedWorkflowService.getGuideById('my-unique-guide-name').overviewSteps = [
                    new WorkflowGuideStep({
                        title: 'Title dynamically fetched',
                        number: 1,
                        path: '/guide/schedule-definitions/*',
                        description: 'Specify occurence interval and amount of instances in the name field.'
                    }),
                    new WorkflowGuideStep({
                        title: 'All these steps',
                        number: 2,
                        path: '/guide/schedule-definitions/*',
                        description: 'These steps are only visible here in overview.'
                    }),
                    new WorkflowGuideStep({
                        title: 'Are visible only in overview',
                        number: 3,
                        path: '/guide/schedule-definitions/*',
                        description: 'They have been fetched dynamically.'
                    })
                ];
                resolve();
            });
        })
    }
});

``` 

###show(id:_string_, startAtStep?: number)

Shows a certain guide.

```
 this.guidedWorkflowService.show('my-unique-guide-name');
``` 

To show a guide and start at a certain step, enter the step number as a second parameter:

```
 this.guidedWorkflowService.show('my-unique-guide-name', 2);
``` 

###hide(id:_string_)

Hides a certain guide.

```
 this.guidedWorkflowService.hide('my-unique-guide-name');
``` 

###getGuideById(id:_string_)

Returns a certain guide, useful if you want to change the breadcrumb, the steps and so on.

```
this.guidedWorkflowService.getGuideById('my-unique-guide-name').breadcrumb = [
    new BreadcrumbItem({ id: 1, title: 'Create bill specification' }),
    new BreadcrumbItem({ id: 2, title: 'Edit schedule definition' })
];
``` 


###getVisibleGuide(): _WorkflowGuide_

Returns the currently visible guide.

```
let visibleGuide = this.guidedWorkflowService.getVisibleGuide();
``` 

###changeStep(guide: _WorkflowGuide_, goToStep:_number_)

If you manually want to change the step of a guide, call this function.

```
let myGuide = this.guidedWorkflowService.getGuideById('my-unique-guide-name');
this.guidedWorkflowService.changeStep(myGuide, 3);
``` 

###createSnackbar(message:_string_, item?:_ActionItem_): _SnackBarComponent_

Use the GuidedWorkflowService's own createSnackbar function to make sure the snackbar gets positioned correctly (above the guide).

```
...
let _action = new ActionItem({
    label: 'Close',
    action: 'close'
});
let snackBar = this._guidedWorkflowService.createSnackbar(this.title + ' saved', _action);
snackBar.onAction.subscribe(() => snackBar.close() );
 ...
```

##Events

The service emits some events that might come in handy.

###onWorkflowShow$

Emits when a guide has been shown.

```
this._guidedWorkflowService.onWorkflowShow$.subscribe((guide: WorkflowGuide) => { });
```

###onWorkflowHide$

Emits when a guide has been hidden.

```
this._guidedWorkflowService.onWorkflowHide$.subscribe((guide: WorkflowGuide) => { });
```

###onChangeStep$

Emits when the guide's active step becomes changed.

```
this._guidedWorkflowService.onChangeStep$.subscribe((guide: WorkflowGuide, goToStep: number) => {
    // guide = the guide where a step was changed
    // goToStep = the step number where we're heading
});
```

###onEnterStep$

Emits when a step has been entered.

```
this._guidedWorkflowService.onEnterStep$.subscribe((step: WorkflowGuideStep) => { });
```

###onLeaveStep$

Emits when a step has been left.

```
this._guidedWorkflowService.onLeaveStep$.subscribe((step: WorkflowGuideStep) => { });
```

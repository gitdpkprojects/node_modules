[//]: # (title: Library)
[//]: # (category: Library)
[//]: # (icon: fa-folder-open)

#Library
* import { ActionItem, LibraryGroup, LibraryModule, TactileBlockItem } from '@ericsson/oden';

A Library is used to present entities in the form of tactile blocks. A library should only be used inside a [Drawer](#/readme/drawer.md).

```
<cui-library
    [title]="string"
    [customPagination]="boolean"
    [paginationData]="PaginationData"
    [actions]="Array<ActionItem>"
    (onActionClick)="function($event)"
    (onButtonActionClick)="function($event)"
    (onCategoryFilterChange)="function($event)"
    (onGroupChange)="function($event)"
    (onPagination)="function($event)"
    [groups]="Array<LibraryGroup>">
</cui-library>
```

###[title]_:string___*__
The title of the library.

###[actions]_:Array&lt;ActionItem&gt;_
Optional. Array of ActionItems that will be rendered as a Multi action button in the library's top right corner.

###(onActionClick)_:function($event)_
This function will be called when the user clicks on an ActionItem inside the Multi action button.

###(onButtonActionClick)_:function($event)_
This function will be called when the user clicks on a Tactile block button in the library.

###[groups]_:Array&lt;LibraryGroup&gt;_
An array of Library groups. Each group will be represented by an inline tab page that has its own Library items (tactile blocks) and filtering functions.

###[customPagination]_:boolean_
An optional property to use custom pagination. Defaults to false. If true, inbuilt pagination and filtering will not be handled by the component.
Use when the data size is large and the server side pagination is needed.

###[paginationData]_:PaginationData_
Enables you to specify pagination data. See paginationData model under Pagination.

###(onCategoryFilterChange)_:function($event)_
This function will be called when the user changes something in the category filter.

###(onGroupChange)_:function($event)_
This function will be called when the user changes active group/tab. The new `LibraryGroup` gets passed.

###(onPagination)_:function($event)_
This function will be called when the pagination is triggered. Sends the PaginationData whenever the pagination occures.

## LibraryService
Import LibraryModule.forRoot() to instantiate LibraryService

####library-group.model.ts
```
export class LibraryGroup {
    title: string;
    items: Array<TactileBlockItem>;
    active: boolean = false;
    categoryFilters?: Array<ListControllerCategoryFilterGroup> = [];
    filterString?: string = '';
    showNumberOfResults?: boolean = false;
    isFiltersExpanded?: boolean = false;
    expandableTactileBlocks?: boolean = false;
}
```
The `expandableTactileBlocks` determines if tactile blocks in group can be expanded/collapsed individually, default is false.

####tactile-block-item.model.ts
```
export class TactileBlockItem {
    id: string = 'tactile-' + UUID.create();
    title: string;
    placeholderTitle?: string;
    subtitle?: string;
    description?: string;
    colorCode?: string; // ie '#f4b600'
    type: Array<string> = [];
    buttonActions?: Array<ActionItem | Divider>;
    menuActions?: Array<ActionItem | Divider>;
    persist: boolean = false;
    data: any;
    draggableItem?: any; // needed in conjunction with ie BlockTree
    disabled?: boolean = false;
    selectable?: boolean = false;
    tooltip?: string = null;
    childComponent?: ITactileBodyInterface | any; // Expects a Type - not an instance
    libraryChildComponent?: ITactileBodyInterface | any; // Expects a Type - not an instance
    selectLabel?: string = 'Edit'; // Not used
    icon?: string;
    iconTooltip?: string;
    libraryMenuActions?: Array<ActionItem | Divider>;
    subtype?: string;
    humanReadableId?: string;
    modifiedDate?: Date;
}
```

###draggableItem?_:any_
To use the Library together with the [Block tree component](#/readme/block-tree.md), make sure you set the `draggableItem` property to a `new BlockTreeBranch({...})` or a `new BlockTreeBranchLeaf({...})`. When the tactile block is dropped on the Block tree, it will transform into this `draggableItem` and inherit the `TactileBlock` item in its `data` property.

##Usage example

####component.html
```
<cui-library [title]="'Library'"
    [actions]="actions" (onActionClick)="libraryOnActionClick($event)"
    (onButtonActionClick)="tactileOnActionClick($event)"
     (onCategoryFilterChange)="onCategoryFilter($event)"
    [groups]="groups"></cui-library>
```

####component.ts
```
export class ExampleComponent implements IDrawerContent {
    drawerPosition: DRAWER_POSITION = DRAWER_POSITION.RIGHT;
    actions: Array<ActionItem>;
    groups: Array<LibraryGroup>;
    blockActions: Array<ActionItem>;

    constructor(private _router: Router, public libraryViewService: LibraryViewService,
         public dropzoneService: DropzoneService,
        public filterService: FilterService
         ) {
        this.actions = [
            new ActionItem({action: 'create_condition', label: 'Condition'}),
            new ActionItem({action: 'create_action', label: 'Action'})
        ];
        this.blockActions = [
            new ActionItem({action: 'add', label: 'Add item'})
        ];
        this.groups = [
            new LibraryGroup({title: 'Conditions',
            items: [
                new TactileBlockItem({title: 'Condition item', colorCode: '#F9BA00', actions: this.blockActions,
                    subtitle: 'Condition', description: 'This is a condition item'})
            ],
            categoryFilters: [
                new ListControllerCategoryFilterGroup({
                    label: 'Colors',
                    field: 'colors',
                    items: [
                        new ListControllerCategoryFilterItem({label: 'Orange', field: '#F9BA00'}),
                        new ListControllerCategoryFilterItem({label: 'Green', field: '#88b916'}),
                        new ListControllerCategoryFilterItem({label: 'None', field: 'none'})
                    ]
                })
            ]
            }),
            new LibraryGroup({title: 'Actions', items: [
                new TactileBlockItem({title: 'Action item', actions: this.blockActions,
                    subtitle: 'Action', description: 'This is an action item'}),
                new TactileBlockItem({title: 'Another action', colorCode: '#88B916', actions: this.blockActions,
                    subtitle: 'Action', description: 'Another action item'})
            ]}),
        ];
    }

    tactileOnActionClick(libraryAction: LibraryAction): void {
        if (libraryAction.action === 'add') {
            // add item to a dropzone here
            this.dropzoneService.addTactileBlockToDropzone(this.libraryViewService.dropzone, libraryAction.item);
        }
    }

    libraryOnActionClick(action: ActionItem): void {
        if (action.action === 'create_condition') {
            this._router.navigateByUrl('/conditions/create');
        }
        if (action.action === 'create_action') {
            this._router.navigateByUrl('/actions/create');
        }
    }

    /**
     * When the category filter is changed
     * @param obj Consists of 'group' and 'ngModel'
     */
    onCategoryFilter(obj: any): void {
        let activeGroup = this.groups.filter((_group: LibraryGroup) => {
            return _group.active;
        });
        let group = activeGroup.length > 0 ? activeGroup[0] : null;
        if (group) {
            if (obj.group.field === 'colors') {
                let colors = obj.ngModel.map((o) => o['field']);
                this.filterService.setFilter(group.id, 'colors', group.items.filter((_item: TactileBlockItem) => {
                    return colors.indexOf(_item.colorCode) > -1 || (_item.colorCode === undefined && colors.indexOf('none') > -1);
                }));
            }
        }
    }


}
```


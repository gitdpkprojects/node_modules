@import '../../assets/styles/core';
.cui-block-tree {
    display: block;
    width: 100%;
    position: relative;
    &.engaged {
        background-color: $engaged;
    }
    &:not(.hidden-root-tree) {
        background: $block-background;
        cursor: pointer;
    }
    > .wrapper-wrapper {
        border: 1px $lightgrey3 solid;
        padding: 0 16px 16px 16px;
        margin: 32px 0;
        transition: $trans-padding, $trans-border, $trans-bg, $trans-border, $trans-height;
        transition-duration: $dur2;
        overflow: hidden;
        .cui-block-tree-branch {
            + .cui-droppable {
                &.cui-dropelement {
                    &:last-child {
                        display: none;
                    }
                }
            }
        }
        .cui-block-tree-branch-leaf {
            + .cui-droppable {
                &.cui-dropelement {
                    &:last-child {
                        margin-bottom: 0px;
                    }
                }
            }
        }
    }
    &:focus {
        outline: none;
        &.focus {
            > .wrapper-wrapper {
                outline: none;
                @include box-shadow(0, 0, 2px, 2px transparentize($lightblue, 0.8));
            }
        }
    }
    &.selected {
        > .wrapper-wrapper {
            @include theming(background-color, brand-primary, $opaque-100, $tint-95);
            @include theming(border-color, brand-primary);
        }
    }
    &.hidden-root-tree {
        margin-top: 32px;
        > .wrapper-wrapper{
            margin-top: 0;
            background: none;
            border-style: dashed;
            > .wrapper {
                margin-top: 8px;
                > .above-content {
                    > .header {
                        display: block;
                        opacity: 0;
                        overflow: hidden;
                        max-height: 0!important;
                        margin-bottom: -8px;
                        pointer-events: none;
                    }
                    > .cui-action-menu, > .switcher-options {
                        max-height: 0;
                    }
                }
            }
        }
    }
    .collapse-block-tree {
        cursor: pointer;
        display: inline-block;
        padding: 5px 0;
        text-align: right;
        position: absolute;
        right: 0;
        top: -28px;
        text-transform: uppercase;
        font-size: 11px;
        color: $grey;
        transition: $trans-color;
        &:hover, &:active {
            color: #000;
        }
    }
    > .wrapper-wrapper > .wrapper {
        margin-top: 16px;
        transition: $trans-margin;
        transition-duration: $dur2;
        > .above-content {
            padding-right: 145px;
            > .header {
                display: inline-block;
                transition: $trans-fade-in, $trans-max-height, $trans-margin;
                transition-duration: $dur2;
                max-height: 30px;
                margin-bottom: 16px;
                max-width: 100%;
                white-space: nowrap;
                > h4 {
                    margin-left: 2px;
                    margin-top: 0;
                    margin-bottom: 0;
                    padding-top: 3px;
                    display: inline-block;
                    @include truncate-text();
                    position: relative;
                    padding-right: 21px;
                    .items-count {
                        color: $grey;
                        font-size: 13px;
                        margin-left: 4px;
                        display: inline-block;
                        &.hidden {
                            opacity: 0;
                        }
                    }
                }
                > .cui-icon {
                    cursor: pointer;
                    vertical-align: top;
                    border-radius: 50%;
                    margin-right: 4px;
                    transition: $trans-rotation;
                    border: 1px solid $lightgrey;
                    color: $lightgrey;
                }
            }
            > .cui-action-menu {
                position: absolute;
                right: 17px;
                margin: -5px 0 0 0;
                max-height: 30px;
                transition: $trans-fade-in, $trans-max-height;
            }
            > .switcher-options {
                display: block;
                position: absolute;
                right: 17px;
                &.next-to-action-menu {
                    right: 55px;
                }
                margin: -8px 0 0 0;
                transition: $trans-fade-in, $trans-max-height;
                max-height: 40px;
                > div {
                    display: inline-block;
                    margin-left: 10px;
                }
            }
            > .hover-item {
                &:not(.always-show) {
                    opacity: 0;
                    pointer-events: none;
                }
                transition: $trans-fade-in, $trans-max-height;
                &.visible {
                    opacity: 1;
                    pointer-events: auto;
                }
            }
        }
        > .content {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            counter-reset: section;
            &.display-position {
                > .cui-dropelement.engaged,
                > .cui-block-tree-branch,
                > .cui-block-tree-branch-leaf {
                    counter-increment: section;
                }
                > .cui-block-tree-branch,
                > .cui-block-tree-branch-leaf {
                    position: relative;
                    &:before {
                        @include index-panel();
                        // Resetting left for items (branches) with no left border
                        left: -1px;
                        content: counter(section)
                    }
                    &:hover:before {
                        opacity: 1;
                    }
                }
            }
        }
    }
    .dragging &.is-droppable > .wrapper-wrapper > .wrapper > .content {
        > .cui-block-tree-branch:before,
        > .cui-block-tree-branch-leaf:before {
            opacity: 1 !important;
        }
    }
    &:not(.expanded) {
        > .wrapper-wrapper > .wrapper > .above-content > .header > .cui-icon {
            @include transform(rotate(180deg));
        }
    }
    &.is-empty > .wrapper-wrapper > .wrapper {
        min-height: 200px;
        position: relative;
        .cui-dropelement.is-droppable {
            height: 250px !important;
            position: absolute;
            top: -23px;
            left: -16px;
            width: calc(100% + 32px);
            pointer-events: none;
            &.visible:not(.engaged) {
                background: none;
            }
        }
        > .above-content {
            > .cui-action-menu {
                right: 0;
            }
            > .switcher-options {
                right: 0;
                &.next-to-action-menu {
                    right: 38px;
                }
            }
        }
    }
    .drop-placeholder {
        text-align: center;
        position: absolute;
        top: 30px;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        z-index: 0;
        opacity: 0;
        pointer-events: none;
        &.visible {
            opacity: 1;
            pointer-events: auto;
        }
        > div {
            position: relative;
            top: 50%;
            @include transform(translateY(-50%));
            padding: 20px;
        }
        h3 {
            font-size: 20px;
            color: $lightgrey;
            margin: 0;
            .cui-icon {
                margin-top: -4px;
            }
        }
        p {
            font-size: 13px!important;
            color: $lightgrey!important;
            margin: 8px auto!important;
            max-width: 400px;
            max-height: 70px;
            overflow: hidden;
        }
    }
    .dragging & {
        &.is-droppable:not(.hidden-root-tree) > .wrapper-wrapper {
            border: 1px solid $lightblue;
        }
        &.is-empty {
            .cui-dropelement.is-droppable {
                pointer-events: auto!important;
            }
        }
        &:not(.expanded):not(.is-empty) > .wrapper-wrapper {
            height: 104px!important;;
            max-height: none!important;
        }
    }
    @-moz-document url-prefix() {
        .cui-dropelement {
            &.visible {
                margin-bottom: -10px;
            }
        }
    }
}

[theme=dark] {
    .cui-block-tree {
        background: $darktheme-bg-darker;
        color: $darktheme-white-trans-mid;
        &.engaged {
            background: $darktheme-engaged;
        }
    }
    .collapse-block-tree {
        &:hover, &:active {
            color: $darktheme-white-trans-high;
        }
    }
}

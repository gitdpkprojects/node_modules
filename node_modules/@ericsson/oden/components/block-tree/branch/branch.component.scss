@import '../../../assets/styles/core';

$border-left-size: 8px;

.cui-block-tree-branch {
    display: block;
    border: 1px solid rgba(0,0,0, 0.2);
    width: 100%;
    padding: 0 16px;
    margin: 0;
    &.parent-is-tree:not(.engaged).display-position>.wrapper>.content {
        > .cui-block-tree-branch-leaf,
        >.cui-block-tree-branch {
            &:before {
                @include index-panel($alto);
            }
        }
    }
    &.engaged>.wrapper>.content>.engaged > .position-index{
        &:before {
            @include index-panel($alto);
            transform: none;
            transform: scaleY(1) translateX(-100%);
        }
    }
    @-moz-document url-prefix() {
        &:not(first-child) {
            margin-top: 16px;
        }
    }
    &.newly-created {
        opacity: 0;
    }
    transition: $trans-hover-box, $trans-bg, $trans-margin, $trans-translateYX, $trans-fade-in;
    border-radius: 3px;
    z-index: 1;
    cursor: default;
    background: $block-background;
    &.currently-dragging {
        border: none!important;
        > .wrapper > .above-content {
            > .header > h4 {
                color: #000!important;
            }
            .hover-item, .cui-icon, .items-count {
                opacity: 0 !important;
                pointer-events: none;
                display: none;
            }
        }
    }
    &.clickable {
        cursor: pointer;
    }
    &:not(.expanded).is-draggable:not(.currently-dragging-clone):not(.engaged):hover {
        cursor: move;
        cursor: grab;
        cursor: -moz-grab;
        cursor: -webkit-grab;
    }
    &:last-child {
        margin-bottom: -6px;
    }
    .auto-engaged:first-child {
        margin-top: -4px;
    }
    &.is-draggable:not(.currently-dragging-clone):hover {
        @include box-shadows(0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23));
        &.focus {
            @include box-shadows(0 0 10px transparentize($lightblue, 0.5), 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23));
        }
    }
    &.hover-to-open {
        background-color: $engaged;
        transition-duration: 1200ms;
        > .wrapper > .above-content > .header > .cui-icon {
            transition-duration: 800ms;
            @include transform(rotate(0deg)!important);
        }
    }
    &:focus {
        outline: none;
        &.focus {
            @include box-shadow(0, 0, 10px, transparentize($lightblue, 0.5));
        }
    }
    &.selected {
        @include theming(background-color, brand-primary, $opaque-100, $tint-95);
        @include theming(border-color, brand-primary);
    }
    > .wrapper {
        padding-top: 16px;
        position: relative;
        overflow: visible;
        height: 100%;
        > .above-content {
            padding-right: 110px;
            > .header {
                display: inline-block;
                margin-bottom: 24px;
                max-width: calc(100% - 75px);
                white-space: nowrap;
                > h4 {
                    margin-left: 2px;
                    margin-top: 0;
                    margin-bottom: 0;
                    display: inline-block;
                    @include truncate-text();
                    max-width: calc(100% - 30px);
                    position: relative;
                    padding-right: 24px;
                    .items-count {
                        color: $grey;
                        font-size: 13px;
                        margin-left: 4px;
                        display: inline-block;
                        transition: $trans-fade-in;
                        position: absolute;
                        right: 0;
                        top: 2px;
                        &.hidden {
                            opacity: 0;
                            transition: $trans-fade-in;
                        }
                    }
                    > .cui-icon {
                        margin-top: -1px;
                    }
                    > .subtitle {
                        display: block;
                        vertical-align: middle;
                        color: $grey;
                        text-transform: uppercase;
                        font-size: 10px;
                        margin: -5px 0;
                    }
                }
                > .cui-icon {
                    cursor: pointer;
                    vertical-align: top;
                    border-radius: 50%;
                    margin-right: 4px;
                    transition: $trans-rotation;
                    border: 1px solid $lightgrey;
                    color: $lightgrey;
                }
            }
            > .extra-header {
                display: inline-block;
                margin-left: 8px;
                position: relative;
                top: -6px;
            }
            > .switcher-options {
                display: block;
                position: absolute;
                right: 0;
                &.next-to-action-menu {
                    right: 40px;
                }
                margin: -8px 0 0 0;
                > div {
                    display: inline-block;
                    margin-left: 10px;
                }
            }
            > .hover-item {
                transition: $trans-fade-in;
                &:not(.always-show) {
                    opacity: 0;
                    pointer-events: none;
                }
                &.visible {
                    opacity: 1;
                    pointer-events: auto;
                }
            }
            > .cui-action-menu {
                position: absolute;
                right: 0;
                margin: -5px 0 0 8px;
            }
        }
        > .content {
            margin-top: 4px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            width: 100%;
            .cui-dropelement:first-child {
                pointer-events: none;
                margin-top: -16px;
            }
        }
    }
    &:not(.expanded) {
        &:not(.selected) {
            background-color: $white;
        }
        > .wrapper > .above-content > .header > .cui-icon {
            @include transform(rotate(180deg));
        }
        .cui-dropelement {
            opacity: 0!important;
        }
    }
    &.operator:not(.currently-dragging-clone) {
        border: 1px solid;
        border-left: $border-left-size solid;
        &:before {
            // Position absolut (index) element. Setting it to -border-left-size to make it align to the border.
            left: -$border-left-size !important;
        }
        > .wrapper > .above-content > .header > .cui-icon {
            border: none;
            color: #fff;
        }
        > h4 {
            padding: 0 8px;
        }
    }
    &.anim-next {
        transform: translate(0, 8px);
    }
    &.anim-prev {
        transform: translate(0, -8px);
    }
}

[theme=dark] {
    .cui-block-tree-branch {
        &:not(.expanded) {
            background: $darktheme-bg-dark;
        }
        &.hover-to-open {
            background-color: $darktheme-engaged;
        }
        border-color: $darktheme-bg-dark1!important;
    }
}

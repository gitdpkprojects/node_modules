<div class="nav-top">
    <cui-container>
        <cui-row [align]="['middle','bottom']" class="unresponsive">
            <cui-column [column-size]="12">
                <cui-list-controller>
                    <cui-list-controller-filter [placeholder]="'ODEN.COMPONENTS.UNIVERSAL_LAYER.FILTER.FILTER_PLACEHOLDER' | translate" [value]="appFilterString" (onFilterChange)="onFilterApps($event)">
                    </cui-list-controller-filter>
                    <cui-list-controller-action
                            (onActionSelect)="onCategoryFilter($event)"
                            [actions]="filterCategories"
                            [action]="filterCategory"
                            [label]="'ODEN.COMPONENTS.UNIVERSAL_LAYER.FILTER.SHOW_AREAS_LABEL' | translate"
                    ></cui-list-controller-action>
                    <cui-list-controller-action
                        (onActionSelect)="onGroupFilter($event)"
                        [actions]="filterGroups"
                        [action]="filterGroup"
                        [label]="'ODEN.COMPONENTS.UNIVERSAL_LAYER.FILTER.GROUP_BY_LABEL' | translate"
                    ></cui-list-controller-action>
                    <cui-list-controller-order [label]="'ODEN.COMPONENTS.UNIVERSAL_LAYER.FILTER.SORT_BY_LABEL' | translate"
                        [orderItem]="currentAppsOrder" [orderItems]="appsOrderItems" [selectFirstItem]="false"
                        (onOrderChange)="onAppsOrderChange($event)"></cui-list-controller-order>
                    <cui-list-controller-general [label]="'ODEN.COMPONENTS.UNIVERSAL_LAYER.SHOW_SITEMAP' | translate">
                        <cui-switcher [(ngModel)]="showSitemap" (change)="toggleSitemap()"></cui-switcher>
                    </cui-list-controller-general>
                </cui-list-controller>
            </cui-column>
        </cui-row>
    </cui-container>
</div>

<div>
    <ng-container *ngIf="filterGroup && filterGroup.action === 'area'; else nongrouptemplate">
        <div *ngFor="let group of groupedApps; trackBy: trackBy" class="group-container">
            <cui-container>
                <cui-group-title [groupTitle]="group.groupName" [attributes]="group.attributes">
                </cui-group-title>
            </cui-container>
            <ng-container *ngTemplateOutlet="groupitemtemplate;context:{ $implicit: group.apps, dispAppsCol1: group.colData[0], dispAppsCol2: group.colData[1], dispAppsCol3: group.colData[2], dispAppsCol4: group.colData[3] }"></ng-container>
        </div>
        <cui-row>
            <cui-column>
                <div [cuiElementOverlay]="overlayConfig" (onElementOverlayAction)="onElementOverlayAction($event)"></div>
            </cui-column>
        </cui-row>
    </ng-container>
</div>

<ng-template #nongrouptemplate>
    <div class="non-group-container">
        <ng-container
            *ngTemplateOutlet="groupitemtemplate;context:{$implicit: displayApps, dispAppsCol1: appsCol1, dispAppsCol2: appsCol2, dispAppsCol3: appsCol3, dispAppsCol4: appsCol4 }">
        </ng-container>
    </div>
</ng-template>

<!-- Group items template -->
<ng-template #groupitemtemplate let-dispApps let-dispAppsCol1="dispAppsCol1" let-dispAppsCol2="dispAppsCol2" let-dispAppsCol3="dispAppsCol3" let-dispAppsCol4="dispAppsCol4">
    <ng-container *ngIf="showSitemap" [ngTemplateOutlet]="sitemap" [ngTemplateOutletContext]="{$implicit: dispApps, dispAppsCol1: dispAppsCol1, dispAppsCol2: dispAppsCol2, dispAppsCol3: dispAppsCol3, dispAppsCol4: dispAppsCol4 }"></ng-container>
    <ng-container *ngIf="!showSitemap" [ngTemplateOutlet]="no_sitemap" [ngTemplateOutletContext]="{$implicit: dispApps, dispAppsCol1: dispAppsCol1, dispAppsCol2: dispAppsCol2, dispAppsCol3: dispAppsCol3, dispAppsCol4: dispAppsCol4 }"></ng-container>
</ng-template>

<!-- Site map template -->
<ng-template #sitemap let-dispApps let-dispAppsCol1="dispAppsCol1" let-dispAppsCol2="dispAppsCol2" let-dispAppsCol3="dispAppsCol3" let-dispAppsCol4="dispAppsCol4">
    <cui-container>
        <cui-row>
            <cui-column column-size="3" *ngFor="let app of dispApps; trackBy: trackBy" class="no-max-width">
                <ng-container *ngTemplateOutlet="appCard;context:{$implicit: app }"></ng-container>
            </cui-column>
        </cui-row>
    </cui-container>
</ng-template>

<!-- Non Site map template -->
<ng-template #no_sitemap let-dispApps let-dispAppsCol1="dispAppsCol1" let-dispAppsCol2="dispAppsCol2" let-dispAppsCol3="dispAppsCol3" let-dispAppsCol4="dispAppsCol4">
    <cui-container *ngIf="menuCardView === 'grid_large' || menuCardView === ''">
        <cui-row>
            <cui-column>
                <div [cuiElementOverlay]="overlayConfig" (onElementOverlayAction)="onElementOverlayAction($event)"></div>
            </cui-column>
        </cui-row>
        <cui-row>
            <cui-column column-size="3">
                <cui-row>
                    <cui-column column-size="12">
                        <ng-container *ngFor="let appCol1 of dispAppsCol1; trackBy: trackBy">
                            <ng-container *ngTemplateOutlet="appCard;context:{$implicit: appCol1 }"></ng-container>
                        </ng-container>
                    </cui-column>
                </cui-row>
            </cui-column>
            <cui-column column-size="3">
                <cui-row>
                    <cui-column column-size="12">
                        <ng-container *ngFor="let appCol2 of dispAppsCol2; trackBy: trackBy">
                            <ng-container *ngTemplateOutlet="appCard;context:{$implicit: appCol2 }"></ng-container>
                        </ng-container>
                    </cui-column>
                </cui-row>
            </cui-column>
            <cui-column column-size="3">
                <cui-row>
                    <cui-column column-size="12">
                        <ng-container *ngFor="let appCol3 of dispAppsCol3; trackBy: trackBy">
                            <ng-container *ngTemplateOutlet="appCard;context:{$implicit: appCol3 }"></ng-container>
                        </ng-container>
                    </cui-column>
                </cui-row>
            </cui-column>
            <cui-column column-size="3">
                <cui-row>
                    <cui-column column-size="12">
                        <ng-container *ngFor="let appCol4 of dispAppsCol4; trackBy: trackBy">
                            <ng-container *ngTemplateOutlet="appCard;context:{$implicit: appCol4 }"></ng-container>
                        </ng-container>
                    </cui-column>
                </cui-row>
            </cui-column>
        </cui-row>
    </cui-container>

    <cui-container *ngIf="menuCardView === 'grid_medium'">
        <cui-row>
            <cui-column column-size="6" *ngFor="let app of dispApps; trackBy: trackBy">
                <ng-container *ngTemplateOutlet="appCard;context:{$implicit: app }"></ng-container>
            </cui-column>
        </cui-row>
    </cui-container>

    <cui-container *ngIf="menuCardView === 'grid_small'">
        <cui-row>
            <cui-column column-size="1" *ngFor="let app of dispApps; trackBy: trackBy">
                <ng-container *ngTemplateOutlet="appCard;context:{$implicit: app }"></ng-container>
            </cui-column>
        </cui-row>
    </cui-container>
</ng-template>

<!-- Application Card template-->
<ng-template #appCard let-app>
    <cui-menu-card
        [newWindow]="app.newWindow"
        [tabindex]="0"
        [clickable]="menuCardClickable || !(app.routes && app.routes.length > 0)"
        (onMenuSelected)="clickMenuItem($event)"
        [loadingId]="loadingId"
        [menuItems]="app.routes"
        [category]="app.category"
        [title]="app.name"
        [id]="app.id"
        [favorite]="app.favorite"
        [favoritesEnabled]="favoritesEnabled"
        (onClick)="onMenuCardClick($event, app)"
    ></cui-menu-card>
</ng-template>

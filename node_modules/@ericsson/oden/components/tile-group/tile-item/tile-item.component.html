<div class="wrapper" (click)="itemClick($event)" [class.drilldown]="tileData?.path != null" [cuiElementOverlay]="tileData.discontinued ? overlayConfig : null">
    <div class="image" *ngIf="layout === 'landscape'" [class.empty]="fullSized || !tileData.image || tileData.image === ''"><div class="loading" [attr.data-image]="tileData.image ? tileData.image : null"></div></div>
    <div class="tile-header">
        <div cui-indicate-dragging class="tile-draggable">
            <cui-icon [icon]="'movable'"></cui-icon>
        </div>
        <div class="tile-title">
            <input cui-checkbox type="checkbox" [checked]="tileData.selected" [attr.id]="'select-'+tileData.uuid"
                (change)="onTileSelect($event, tileData)"/>
            <label [attr.for]="'select-'+tileData.uuid"></label>
            <div class="subtitles-container">
                <span class="subtitle" *ngIf="tileData?.subtitle">{{tileData?.subtitle}}</span>
                <span class="subtype" *ngIf="tileData?.subtype">{{tileData?.subtype}}</span>
            </div>
            <cui-icon [icon]="tileData.icon" [cuiTooltip]="tileData.iconTooltip" class="small" *ngIf="tileData.icon"></cui-icon>
            <h2 [cuiTooltip]="titleTooltip" [innerHTML]="tileData?.label"></h2>
        </div>
        <div *ngIf="tileActions?.length" class="tile-actions">
            <cui-action-menu [actions]="tileActions" (onActionClick)="actionClick($event)"></cui-action-menu>
        </div>
    </div>
    <div class="meta" *ngIf="layout === 'portrait'">
        <div class="image" [class.empty]="fullSized || !tileData.image || tileData.image === ''"><div class="loading" [attr.data-image]="tileData.image ? tileData.image : null"></div></div>
    </div>
    <div class="tile-main" *ngIf="layout !== 'portrait'">
        <div class="meta">
            <ng-template [ngTemplateOutlet]="metaTemplate"></ng-template>
        </div>
        <ng-template [ngTemplateOutlet]="descriptionTemplate" *ngIf="!fullSized"></ng-template>
    </div>
    <div class="content" [class.empty]="!fullSized && layout === 'portrait' && !hasMeta && !tileData.text && !tileData.modifiedDate">
        <div class="cui-tile-section" *ngIf="layout === 'portrait'">
            <div class="meta" [class.empty]="!hasMeta">
                <ng-template [ngTemplateOutlet]="metaTemplate"></ng-template>
            </div>
            <ng-template [ngTemplateOutlet]="descriptionTemplate"></ng-template>
        </div>
        <ng-content></ng-content>
        <ng-container *ngIf="!fullSized">
            <cui-tile-section *ngFor="let section of tileData?.sections" [sectionData]="section"></cui-tile-section>
        </ng-container>
        <div class="cui-tile-section" *ngIf="layout === 'landscape' && fullSized">
            <ng-template [ngTemplateOutlet]="descriptionTemplate"></ng-template>
        </div>
    </div>
    <div class="section-set" *ngIf="layout === 'portrait' && sections.length > 1">
        <cui-icon
            class="small"
            icon="chevron-left" [class.section-set-pointer-active]="currentSection > 0"
            (click)="prevSection($event)"></cui-icon>
        <div class="section-pointers">
            <div *ngFor="let _section of sections; let i = index" (click)="changeSection($event, i)"><span [class.current-section-set]="currentSection === i"></span></div>
        </div>
        <cui-icon
            class="small"
            icon="chevron-right"
            [class.section-set-pointer-active]="currentSection < sections.length - 1"
            (click)="nextSection($event)"></cui-icon>
    </div>
</div>
<ng-container *ngIf="titleTooltipTemplate">
    <div class="title-tooltip"><ng-template [ngTemplateOutlet]="titleTooltipTemplate"></ng-template></div>
</ng-container>
<ng-container *ngIf="!titleTooltipTemplate">
    <div class="title-tooltip"><h4>{{'ODEN.COMMON.NAME' | translate}}</h4><p>{{tileData.label}}</p>
        <ng-container *ngIf="tileData.id">
            <h4>{{'ODEN.COMMON.ID' | translate}}</h4><p>{{tileData.id}}</p>
        </ng-container>
    </div>
</ng-container>

<ng-template #descriptionTemplate>
    <div class="description-wrapper" [class.is-relationType]="entityRelationType" [class.empty]="fullSized || !tileData.text"><p class="description" [innerHTML]="tileData.text"></p></div>
    <div class="meta-data">
        <cui-tag *ngIf="entityRelationType" [tag]="entityRelationType" [readonly]="true"></cui-tag>
        <div class="tile-modified" [class.empty]="!tileData.modifiedDate">{{'ODEN.COMMON.MODIFIED' | translate}}: {{tileData.modifiedDate ? (tileData.modifiedDate | date:'y-MM-dd HH:mm') : '-'}}</div>
    </div>
</ng-template>

<ng-template #metaTemplate>
    <ng-container *ngIf="versionsInArray > 0">
        <cui-state-badge [cuiTooltip]="draftTooltip" *ngIf="draftFromTileData" [state]="draftFromTileData.state"></cui-state-badge>
        <cui-state-badge [cuiTooltip]="timelineTooltip" *ngIf="nonDraftFromTileData" [state]="nonDraftFromTileData.state" [compact]="true" [extra]="!draftFromTileData && nonDraftFromTileData.extra === 1 ? null : nonDraftFromTileData.extra"></cui-state-badge>
        <span *ngIf="versionsInArray === 1 && versionValidString()" class="activated" [innerHTML]="('ODEN.COMPONENTS.ENTITY_VERSION.VALID' | translate) + ': ' + versionValidString()"></span>
        <div class="timeline-tooltip">
            <cui-timeline [versions]="tileData.versions"></cui-timeline>
        </div>
        <div  class="draft-tooltip">
            <h4>{{'ODEN.COMMON.STATES.DRAFT' | translate}}</h4>
            <ng-container *ngIf="shouldShowDraftTooltip(draftFromTileData); else customDraftTooltipTemplate">
                    <p class="timeline" [innerHTML]="versionValidString(draftFromTileData)"></p>
            </ng-container>
            <ng-template #customDraftTooltipTemplate>
                    <div [innerHTML]="customDraftTooltip"></div>
            </ng-template>
        </div>
    </ng-container>

    <ng-container *ngIf="isNumber(tileData.versions)">
        <cui-state-badge [state]="tileData.state" *ngIf="isNumber(tileData.state)"></cui-state-badge>
        <span *ngIf="tileData?.activeDate" class="activated">{{displayDate}}</span>
        <cui-state-badge *ngIf="numberOfVersions > 0" [tooltip]="tileData.versionsTooltip" [extra]="tileData.versions"></cui-state-badge>
    </ng-container>
</ng-template>

/*
Author @Rajeshkumar PR
Plugin to create app-config file
*/
const path = require('path');
const del = require('del');

class CleanUpPlugin {
    constructor(obj) {
        this.options = {
            exclude: obj ? obj.exclude : []
        };
    }

    apply(compiler) {
        // output path of compiled files
        const outputPath = compiler.options.output.path

        compiler.plugin('done', stats => {
            // gather info from compiled files
            const assetNames = stats.toJson().assets.map(asset => asset.name);

            // gather the list of files to unlink
            const excludeFilesArray = this.options.exclude.map(name => path.join(outputPath, name));

            // execute delete method to delete files and folders(example 'tmp/*.js')
            del(excludeFilesArray).then(paths => {
                console.log('Deleted files :\n', paths.join('\n'));
            });

        });
    }
}

module.exports = CleanUpPlugin;
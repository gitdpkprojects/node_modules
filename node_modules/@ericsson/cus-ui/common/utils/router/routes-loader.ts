import { Bundle } from '../../models/bundle.model';

export function getAppRoutes(metaRoutes: Array<Bundle>) {

    let modulePaths = [];
    if (metaRoutes && metaRoutes.length > 0) {

        metaRoutes.forEach((module) => {
            let path = `${module.moduleFile}#${module.moduleClass}`;
            if (module.basePath.indexOf('/') === -1) {
                // single tpg application.
                modulePaths.push({ path: module.basePath, loadChildren: path });
            } else {
                // multi-tpg application
                let basePath = module.basePath.split('/');
                let parentArray = modulePaths.filter(r => r.path && (r.path === basePath[0]));
                if (parentArray.length === 1) {
                    // if application path already exist.
                    parentArray[0].children.push({ path: '', loadChildren: path })

                    let redirectLink = parentArray[0].children.filter(r => r.redirectTo && r.redirectTo.length > 0);
                    if ((!redirectLink || redirectLink.length === 0) && (module.defaultPath && module.defaultPath.length > 0)) {
                        parentArray[0].children.unshift({ path: '', redirectTo: module.defaultPath, pathMatch: 'full' });
                    }

                } else {
                    // else create a new application path and children array.
                    let childArray = [];
                    if (module.defaultPath && module.defaultPath.length > 0) {
                        childArray.push({ path: '', redirectTo: module.defaultPath, pathMatch: 'full' });
                    }
                    childArray.push({ path: '', loadChildren: path });
                    modulePaths.push({ path: basePath[0], children: childArray });
                }
            }
        });
    }

    return modulePaths;
}

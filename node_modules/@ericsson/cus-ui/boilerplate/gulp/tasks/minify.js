const gulp = require('gulp');
const uglify = require('gulp-uglify');
const babel = require('gulp-babel');
const pump = require('pump');
const conf = require('../config');

/* Minify all build js files */
gulp.task('minify', function(cb) {
    pump([
            gulp.src(['target/.tmp/build/**/*.js', '!target/.tmp/build/systemjs.lib.js']),
            babel({
                presets: ['es2015'],
                compact: false
            }).on('error', function(e) {
                console.error(e);
            }),
            uglify({ mangle: false }).on('error', function(e) {
                console.error(e);
            }),
            gulp.dest(conf.path.dist())
        ],
        cb
    );
});